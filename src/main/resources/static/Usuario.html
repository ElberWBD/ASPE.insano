<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Panel de Usuario</title>
  <link rel="stylesheet" href="CSS/Usuario.css">
</head>
<body>
  <div class="contenedor">
    <aside class="barra">
      <h2>Usuario</h2>
      <ul>
        <li class="activo" onclick="mostrarSeccion('datos')">Datos</li>
        <li onclick="mostrarSeccion('campanas')">Campa√±as</li>
        <li onclick="mostrarSeccion('eliminar')">Eliminar cuenta</li>
        <li onclick="volverInicio()">Volver</li>
      </ul>
    </aside>

    <main class="contenido">
      <!-- DATOS -->
      <section id="datos" class="seccion activa">
        <h2>Datos del Usuario</h2>
        <form class="formulario">
          <div class="campo">
            <label>ID:</label>
            <input id="idCliente" type="text" readonly>
          </div>

          <div class="campo">
            <label>Nombre:</label>
            <input id="nombre" type="text">
          </div>

          <div class="campo">
            <label>Apellido:</label>
            <input id="apellido" type="text">
          </div>

          <div class="campo">
            <label>Raz√≥n Social:</label>
            <input id="razonSocial" type="text">
          </div>

          <div class="campo">
            <label>Email:</label>
            <input id="email" type="email">
          </div>

          <div class="campo">
            <label>Tel√©fono:</label>
            <input id="telefono" type="text">
          </div>

          <div class="campo">
            <label>Contrase√±a:</label>
            <div style="display: flex; align-items: center; gap: 5px;">
              <input id="password" type="password">
              <button type="button" id="togglePassword">üëÅ</button>
            </div>
          </div>

          <div class="campo">
            <label>Fecha de creaci√≥n:</label>
            <input id="fechaCreacion" type="text" readonly>
          </div>

          <button type="button" onclick="guardarCambios()">Guardar Cambios</button>
        </form>
      </section>

      <!-- CAMPA√ëAS -->
      <section id="campanas" class="seccion">
        <h2>Mis Campa√±as</h2>
        <div class="campana-lista">
          <div class="campana-card" onclick="abrirModal('Proyecto Web Empresarial')">
            <h3>Proyecto Web Empresarial</h3>
            <p>Estado: <span class="estado aprobado">Aprobado</span></p>
          </div>
          <div class="campana-card" onclick="abrirModal('Campa√±a de Redes Sociales')">
            <h3>Campa√±a de Redes Sociales</h3>
            <p>Estado: <span class="estado pendiente">Pendiente</span></p>
          </div>
          <div class="campana-card" onclick="abrirModal('Landing Page Promocional')">
            <h3>Landing Page Promocional</h3>
            <p>Estado: <span class="estado en-progreso">En progreso</span></p>
          </div>
        </div>
      </section>

      <!-- ELIMINAR -->
      <section id="eliminar" class="seccion">
        <h2>Eliminar Cuenta</h2>
        <p>Esta acci√≥n eliminar√° permanentemente tu cuenta y todos tus datos.</p>
        <button class="eliminar-btn">Eliminar Cuenta</button>
      </section>
    </main>
  </div>

  <!-- MODAL -->
  <div id="modal" class="modal">
    <div class="modal-contenido">
      <span class="cerrar" onclick="cerrarModal()">&times;</span>
      <h3 id="modal-titulo"></h3>
      <p><strong>Estado:</strong> <span id="modal-estado">Aprobado</span></p>
      <div class="chat">
        <div class="mensaje programador">Hola, el proyecto est√° casi listo.</div>
        <div class="mensaje usuario">Perfecto, espero la versi√≥n final.</div>
        <input type="text" placeholder="Escribe un mensaje...">
      </div>
    </div>
  </div>

  <script>
    // === Cargar datos del usuario ===
    document.addEventListener("DOMContentLoaded", async () => {
      const clienteId = sessionStorage.getItem("clienteId");
      if (!clienteId) {
        alert("‚ö†Ô∏è No has iniciado sesi√≥n.");
        window.location.href = "Login.html";
        return;
      }

      try {
        const response = await fetch(`http://localhost:8080/clientes/buscarPorId/${clienteId}`);
        if (response.ok) {
          const cliente = await response.json();

          // Ajustar nombres a camelCase
          document.getElementById("idCliente").value = cliente.id || "";
          document.getElementById("nombre").value = cliente.nombre || "";
          document.getElementById("apellido").value = cliente.apellido || "";
          document.getElementById("razonSocial").value = cliente.razonSocial || "";
          document.getElementById("email").value = cliente.email || "";
          document.getElementById("telefono").value = cliente.telefono || "";
          document.getElementById("password").value = cliente.password || "";
          document.getElementById("fechaCreacion").value = cliente.fechaCreacion || "";
        } else {
          alert("‚ùå No se encontraron datos del cliente.");
        }
      } catch (error) {
        console.error("Error al cargar datos:", error);
      }
    });

    // === Mostrar / ocultar contrase√±a ===
    document.addEventListener("click", (e) => {
      if (e.target.id === "togglePassword") {
        const passInput = document.getElementById("password");
        if (passInput.type === "password") {
          passInput.type = "text";
          e.target.textContent = "üôà";
        } else {
          passInput.type = "password";
          e.target.textContent = "üëÅ";
        }
      }
    });

    // === Guardar cambios ===
    async function guardarCambios() {
      const clienteId = sessionStorage.getItem("clienteId");
      if (!clienteId) {
        alert("‚ö†Ô∏è No has iniciado sesi√≥n.");
        return;
      }

      const cliente = {
        id: clienteId,
        nombre: document.getElementById("nombre").value,
        apellido: document.getElementById("apellido").value,
        razonSocial: document.getElementById("razonSocial").value,
        email: document.getElementById("email").value,
        telefono: document.getElementById("telefono").value,
        password: document.getElementById("password").value,
        fechaCreacion: document.getElementById("fechaCreacion").value
      };

      try {
        const response = await fetch(`http://localhost:8080/clientes/actualizar/${clienteId}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(cliente)
        });

        if (response.ok) {
          alert("‚úÖ Datos actualizados correctamente");
        } else {
          const text = await response.text();
          console.error("Error actualizar:", text);
          alert("‚ùå Error al actualizar los datos");
        }
      } catch (error) {
        console.error("Error al guardar:", error);
        alert("‚ö†Ô∏è No se pudo conectar con el servidor.");
      }
    }

    // === Navegaci√≥n ===
    function mostrarSeccion(id) {
      document.querySelectorAll(".seccion").forEach(sec => sec.classList.remove("activa"));
      document.getElementById(id).classList.add("activa");
      document.querySelectorAll(".barra ul li").forEach(li => li.classList.remove("activo"));
      event.target.classList.add("activo");
    }

    function abrirModal(nombre) {
      document.getElementById("modal-titulo").textContent = nombre;
      document.getElementById("modal").style.display = "flex";
    }

    function cerrarModal() {
      document.getElementById("modal").style.display = "none";
    }

    function volverInicio() {
      window.location.href = "Index.html";
    }
  </script>
</body>
</html>
